<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - LuckyBet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0c0f1d 0%, #1a1f3d 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1f3d 0%, #0c0f1d 100%);
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .tab-active {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 2px solid #f5576c;
        }
        
        .user-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #f5576c;
        }
        
        .verification-badge {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .pending-badge {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="glass-effect py-4 px-6 flex justify-between items-center">
        <div class="flex items-center">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">LuckyBet</h1>
        </div>
        <div class="hidden md:flex space-x-6">
            <a href="/" class="py-2 hover:text-purple-300">Home</a>
            <a href="/history" class="py-2 hover:text-purple-300">History</a>
            <a href="/profile" class="py-2 nav-active">Profile</a>
            <a href="/admin" class="py-2 hover:text-purple-300" id="adminLink" style="display: none;">Admin</a>
        </div>
        <div class="flex items-center space-x-4">
            <div class="balance-card">
                <div class="text-sm">Balance</div>
                <div class="text-xl font-bold" id="navBalance">$0.00</div>
                <div class="text-xs opacity-70">Demo: <span id="navDemoBalance">$0.00</span></div>
            </div>
            <div class="relative">
                <button id="userMenuButton" class="flex items-center space-x-2 bg-purple-900 bg-opacity-50 rounded-full py-2 px-4">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                        <span class="text-white font-bold" id="navInitials">U</span>
                    </div>
                    <span id="navUserName">User</span>
                    <i class="fas fa-chevron-down text-xs"></i>
                </button>
                <div id="userMenu" class="absolute right-0 mt-2 w-48 glass-effect rounded-lg shadow-lg hidden">
                    <a href="/profile" class="block px-4 py-3 hover:bg-purple-800 rounded-t-lg">Profile</a>
                    <a href="/history" class="block px-4 py-3 hover:bg-purple-800">History</a>
                    <button id="logoutBtn" class="block w-full text-left px-4 py-3 hover:bg-purple-800 rounded-b-lg">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Profile Header -->
        <div class="glass-effect rounded-2xl p-8 mb-8">
            <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
                <div class="text-center">
                    <div class="relative">
                        <img id="userAvatar" src="" alt="Profile" class="user-avatar mx-auto md:mx-0" onerror="this.src=''">
                        <div class="absolute -bottom-2 -right-2">
                            <span id="verificationStatus" class="verification-badge">
                                <i class="fas fa-check mr-1"></i>Verified
                            </span>
                        </div>
                    </div>
                    <button class="btn-secondary mt-4 text-sm" onclick="showAvatarUpload()">
                        <i class="fas fa-camera mr-2"></i>Change Photo
                    </button>
                </div>
                
                <div class="flex-1 text-center md:text-left">
                    <h1 class="text-3xl font-bold" id="userFullName">User Name</h1>
                    <p class="text-gray-300 mt-2" id="userEmail">user@example.com</p>
                    <p class="text-gray-400 mt-1" id="userPhone">+1234567890</p>
                    <p class="text-gray-400 mt-1">Member since <span id="memberSince">2023</span></p>
                    
                    <div class="flex flex-wrap gap-4 mt-6">
                        <div class="stats-card">
                            <div class="text-sm">Real Balance</div>
                            <div class="text-2xl font-bold" id="profileBalance">$0.00</div>
                        </div>
                        <div class="stats-card">
                            <div class="text-sm">Demo Balance</div>
                            <div class="text-2xl font-bold" id="profileDemoBalance">$0.00</div>
                        </div>
                        <div class="stats-card">
                            <div class="text-sm">Total Games</div>
                            <div class="text-2xl font-bold" id="totalGames">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="glass-effect rounded-xl mb-6">
            <div class="flex border-b border-gray-700 overflow-x-auto">
                <button class="tab-active py-4 px-6 font-semibold whitespace-nowrap" onclick="switchTab('edit')">
                    <i class="fas fa-user-edit mr-2"></i>Edit Profile
                </button>
                <button class="py-4 px-6 font-semibold whitespace-nowrap hover:bg-gray-800" onclick="switchTab('security')">
                    <i class="fas fa-shield-alt mr-2"></i>Security
                </button>
                <button class="py-4 px-6 font-semibold whitespace-nowrap hover:bg-gray-800" onclick="switchTab('wallet')">
                    <i class="fas fa-wallet mr-2"></i>Wallet
                </button>
                <button class="py-4 px-6 font-semibold whitespace-nowrap hover:bg-gray-800" onclick="switchTab('stats')">
                    <i class="fas fa-chart-bar mr-2"></i>Statistics
                </button>
                <button class="py-4 px-6 font-semibold whitespace-nowrap hover:bg-gray-800" onclick="switchTab('documents')">
                    <i class="fas fa-id-card mr-2"></i>Documents
                </button>
            </div>
        </div>

        <!-- Edit Profile Tab -->
        <div id="editTab" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Personal Information</h3>
                    <form id="profileForm">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm mb-2">First Name</label>
                                <input type="text" id="editFirstName" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                            </div>
                            <div>
                                <label class="block text-sm mb-2">Last Name</label>
                                <input type="text" id="editLastName" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm mb-2">Phone Number</label>
                            <input type="tel" id="editPhone" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm mb-2">Email Address</label>
                            <input type="email" id="editEmail" class="w-full bg-gray-800 rounded-lg py-3 px-4" readonly>
                            <p class="text-xs text-gray-400 mt-1">Email cannot be changed</p>
                        </div>
                        <button type="submit" class="btn-primary w-full">Save Changes</button>
                    </form>
                </div>

                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Account Status</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-gray-800 rounded-lg">
                            <div>
                                <div class="font-semibold">Email Verification</div>
                                <div class="text-sm text-gray-400">Your email is verified</div>
                            </div>
                            <span class="verification-badge">
                                <i class="fas fa-check mr-1"></i>Verified
                            </span>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-gray-800 rounded-lg">
                            <div>
                                <div class="font-semibold">KYC Verification</div>
                                <div class="text-sm text-gray-400">Identity verification status</div>
                            </div>
                            <span id="kycStatus" class="verification-badge">
                                <i class="fas fa-check mr-1"></i>Verified
                            </span>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-gray-800 rounded-lg">
                            <div>
                                <div class="font-semibold">Account Level</div>
                                <div class="text-sm text-gray-400">Based on your activity</div>
                            </div>
                            <span class="px-3 py-1 bg-purple-600 rounded-full text-sm font-semibold">Standard</span>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-yellow-900 bg-opacity-30 rounded-lg">
                        <h4 class="font-semibold mb-2"><i class="fas fa-info-circle mr-2"></i>Account Tips</h4>
                        <ul class="text-sm space-y-1">
                            <li>• Keep your profile information updated</li>
                            <li>• Use strong password for security</li>
                            <li>• Contact support for any issues</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Tab -->
        <div id="securityTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Change Password</h3>
                    <form id="passwordForm">
                        <div class="mb-4">
                            <label class="block text-sm mb-2">Current Password</label>
                            <input type="password" id="currentPassword" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm mb-2">New Password</label>
                            <input type="password" id="newPassword" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm mb-2">Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                        </div>
                        <button type="submit" class="btn-primary w-full">Update Password</button>
                    </form>
                </div>

                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Security Settings</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-gray-800 rounded-lg">
                            <div>
                                <div class="font-semibold">Two-Factor Authentication</div>
                                <div class="text-sm text-gray-400">Add extra security to your account</div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:ring-4 peer-focus:ring-purple-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-gray-800 rounded-lg">
                            <div>
                                <div class="font-semibold">Login Notifications</div>
                                <div class="text-sm text-gray-400">Get alerts for new logins</div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-700 peer-focus:ring-4 peer-focus:ring-purple-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h4 class="font-semibold mb-4">Recent Login Activity</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded-lg">
                                <div>
                                    <div class="text-sm font-semibold">Current Session</div>
                                    <div class="text-xs text-gray-400">Just now • <span id="currentIP">Loading...</span></div>
                                </div>
                                <span class="px-2 py-1 bg-green-500 rounded text-xs">Active</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wallet Tab -->
        <div id="walletTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Deposit Funds</h3>
                    <form id="depositForm">
                        <div class="mb-4">
                            <label class="block text-sm mb-2">Amount ($)</label>
                            <input type="number" id="depositAmount" class="w-full bg-gray-800 rounded-lg py-3 px-4" min="10" step="0.01" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm mb-2">Payment Method</label>
                            <select id="paymentMethod" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                                <option value="">Select payment method</option>
                                <option value="credit_card">Credit Card</option>
                                <option value="paypal">PayPal</option>
                                <option value="crypto">Cryptocurrency</option>
                                <option value="bank_transfer">Bank Transfer</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-primary w-full">Proceed to Deposit</button>
                    </form>

                    <div class="mt-6 p-4 bg-blue-900 bg-opacity-30 rounded-lg">
                        <h4 class="font-semibold mb-2"><i class="fas fa-info-circle mr-2"></i>Deposit Information</h4>
                        <ul class="text-sm space-y-1">
                            <li>• Minimum deposit: $10</li>
                            <li>• Instant processing for most methods</li>
                            <li>• No deposit fees</li>
                            <li>• Contact support for large deposits</li>
                        </ul>
                    </div>
                </div>

                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Withdraw Funds</h3>
                    <form id="withdrawalForm">
                        <div class="mb-4">
                            <label class="block text-sm mb-2">Amount ($)</label>
                            <input type="number" id="withdrawalAmount" class="w-full bg-gray-800 rounded-lg py-3 px-4" min="20" step="0.01" required>
                            <div class="text-xs text-gray-400 mt-1">Available: $<span id="availableBalance">0.00</span></div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm mb-2">Wallet Address</label>
                            <input type="text" id="walletAddress" class="w-full bg-gray-800 rounded-lg py-3 px-4" placeholder="Enter your wallet address" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm mb-2">Withdrawal Method</label>
                            <select id="withdrawalMethod" class="w-full bg-gray-800 rounded-lg py-3 px-4" required>
                                <option value="crypto">Cryptocurrency</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-success w-full">Request Withdrawal</button>
                    </form>

                    <div class="mt-6 p-4 bg-yellow-900 bg-opacity-30 rounded-lg">
                        <h4 class="font-semibold mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>Withdrawal Policy</h4>
                        <ul class="text-sm space-y-1">
                            <li>• Minimum withdrawal: $20</li>
                            <li>• Processing time: 1-3 business days</li>
                            <li>• KYC verification required</li>
                            <li>• Fees may apply for some methods</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="statsTab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="stats-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm opacity-80">Total Games Played</div>
                            <div class="text-2xl font-bold" id="statsTotalGames">0</div>
                        </div>
                        <i class="fas fa-gamepad text-2xl opacity-70"></i>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm opacity-80">Total Bets</div>
                            <div class="text-2xl font-bold" id="statsTotalBets">$0</div>
                        </div>
                        <i class="fas fa-coins text-2xl opacity-70"></i>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm opacity-80">Total Winnings</div>
                            <div class="text-2xl font-bold" id="statsTotalWins">$0</div>
                        </div>
                        <i class="fas fa-trophy text-2xl opacity-70"></i>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Game Distribution</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span>Real Money Games</span>
                            <span class="font-semibold" id="realGamesCount">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Demo Games</span>
                            <span class="font-semibold" id="demoGamesCount">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Favorite Game</span>
                            <span class="font-semibold" id="favoriteGame">N/A</span>
                        </div>
                    </div>
                </div>

                <div class="glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-6">Last Big Win</h3>
                    <div id="lastWinInfo" class="text-center py-8">
                        <i class="fas fa-trophy text-4xl text-yellow-400 mb-4"></i>
                        <p class="text-gray-400">No big wins yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Documents Tab -->
        <div id="documentsTab" class="tab-content hidden">
            <div class="glass-effect rounded-xl p-6">
                <h3 class="text-xl font-bold mb-6">Verification Documents</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <h4 class="font-semibold mb-4">Selfie Photo</h4>
                        <img id="docSelfie" src="" alt="Selfie" class="w-full h-48 object-cover rounded-lg border-2 border-purple-500 mb-2" onerror="this.style.display='none'">
                        <button class="btn-secondary w-full text-sm" onclick="updateDocument('selfie')">
                            <i class="fas fa-sync mr-2"></i>Update
                        </button>
                    </div>
                    
                    <div class="text-center">
                        <h4 class="font-semibold mb-4">ID Front</h4>
                        <img id="docIdFront" src="" alt="ID Front" class="w-full h-48 object-cover rounded-lg border-2 border-purple-500 mb-2" onerror="this.style.display='none'">
                        <button class="btn-secondary w-full text-sm" onclick="updateDocument('idFront')">
                            <i class="fas fa-sync mr-2"></i>Update
                        </button>
                    </div>
                    
                    <div class="text-center">
                        <h4 class="font-semibold mb-4">ID Back</h4>
                        <img id="docIdBack" src="" alt="ID Back" class="w-full h-48 object-cover rounded-lg border-2 border-purple-500 mb-2" onerror="this.style.display='none'">
                        <button class="btn-secondary w-full text-sm" onclick="updateDocument('idBack')">
                            <i class="fas fa-sync mr-2"></i>Update
                        </button>
                    </div>
                </div>

                <div class="mt-8 p-4 bg-blue-900 bg-opacity-30 rounded-lg">
                    <h4 class="font-semibold mb-2"><i class="fas fa-shield-alt mr-2"></i>Document Verification</h4>
                    <p class="text-sm">Your documents are securely stored and used only for verification purposes. 
                    We comply with all data protection regulations.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="text-center">
                <i class="fas fa-check-circle text-4xl text-green-400 mb-4"></i>
                <h3 class="text-xl font-bold mb-2" id="successTitle">Success!</h3>
                <p id="successMessage" class="text-gray-300 mb-6">Operation completed successfully</p>
                <button class="btn-primary" onclick="closeSuccessModal()">OK</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
        });

        // Authentication functions
        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/register-login';
                return;
            }

            try {
                const response = await fetch('/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        currentUser = result.user;
                        updateProfileUI();
                        loadUserStats();
                    } else {
                        throw new Error(result.error);
                    }
                } else {
                    localStorage.removeItem('token');
                    window.location.href = '/register-login';
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('token');
                window.location.href = '/register-login';
            }
        }

        function updateProfileUI() {
            // Navigation
            document.getElementById('navBalance').textContent = `$${currentUser.balance.toFixed(2)}`;
            document.getElementById('navDemoBalance').textContent = `$${currentUser.demoBalance.toFixed(2)}`;
            document.getElementById('navUserName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('navInitials').textContent = `${currentUser.firstName[0]}${currentUser.lastName[0]}`.toUpperCase();
            
            if (currentUser.isAdmin) {
                document.getElementById('adminLink').style.display = 'block';
            }

            // Profile Header
            document.getElementById('userFullName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userPhone').textContent = currentUser.phone;
            document.getElementById('memberSince').textContent = new Date(currentUser.createdAt).getFullYear();
            document.getElementById('profileBalance').textContent = `$${currentUser.balance.toFixed(2)}`;
            document.getElementById('profileDemoBalance').textContent = `$${currentUser.demoBalance.toFixed(2)}`;
            
            // Avatar
            if (currentUser.selfie) {
                document.getElementById('userAvatar').src = `/uploads/${currentUser.selfie}`;
            }
            
            // Verification status
            const verificationBadge = document.getElementById('verificationStatus');
            const kycStatus = document.getElementById('kycStatus');
            if (currentUser.isVerified) {
                verificationBadge.className = 'verification-badge';
                verificationBadge.innerHTML = '<i class="fas fa-check mr-1"></i>Verified';
                kycStatus.className = 'verification-badge';
                kycStatus.innerHTML = '<i class="fas fa-check mr-1"></i>Verified';
            } else {
                verificationBadge.className = 'pending-badge';
                verificationBadge.innerHTML = '<i class="fas fa-clock mr-1"></i>Pending';
                kycStatus.className = 'pending-badge';
                kycStatus.innerHTML = '<i class="fas fa-clock mr-1"></i>Pending';
            }

            // Edit form
            document.getElementById('editFirstName').value = currentUser.firstName;
            document.getElementById('editLastName').value = currentUser.lastName;
            document.getElementById('editPhone').value = currentUser.phone;
            document.getElementById('editEmail').value = currentUser.email;

            // Wallet
            document.getElementById('availableBalance').textContent = currentUser.balance.toFixed(2);

            // Documents
            if (currentUser.selfie) {
                document.getElementById('docSelfie').src = `/uploads/${currentUser.selfie}`;
                document.getElementById('docSelfie').style.display = 'block';
            }
            if (currentUser.idFront) {
                document.getElementById('docIdFront').src = `/uploads/${currentUser.idFront}`;
                document.getElementById('docIdFront').style.display = 'block';
            }
            if (currentUser.idBack) {
                document.getElementById('docIdBack').src = `/uploads/${currentUser.idBack}`;
                document.getElementById('docIdBack').style.display = 'block';
            }
        }

        // Tab management
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.flex.border-b button').forEach(btn => {
                btn.classList.remove('tab-active');
            });
            
            // Show selected tab and set active
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            event.target.classList.add('tab-active');
        }

        // Profile form submission
        document.getElementById('profileForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('firstName', document.getElementById('editFirstName').value);
            formData.append('lastName', document.getElementById('editLastName').value);
            formData.append('phone', document.getElementById('editPhone').value);

            try {
                const response = await fetch('/api/user/profile', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    currentUser = result.user;
                    updateProfileUI();
                    showSuccess('Profile Updated', 'Your profile has been updated successfully');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Profile update failed:', error);
                alert('Failed to update profile');
            }
        });

        // Password form submission
        document.getElementById('passwordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }

            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            try {
                const response = await fetch('/api/user/change-password', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('passwordForm').reset();
                    showSuccess('Password Changed', 'Your password has been updated successfully');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Password change failed:', error);
                alert('Failed to change password');
            }
        });

        // Deposit form submission
        document.getElementById('depositForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const paymentMethod = document.getElementById('paymentMethod').value;

            if (amount < 10) {
                alert('Minimum deposit amount is $10');
                return;
            }

            try {
                const response = await fetch('/api/user/deposit-request', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount,
                        paymentMethod
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('depositForm').reset();
                    showSuccess('Deposit Request Sent', 'Your deposit request has been submitted for processing');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Deposit request failed:', error);
                alert('Failed to submit deposit request');
            }
        });

        // Withdrawal form submission
        document.getElementById('withdrawalForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('withdrawalAmount').value);
            const walletAddress = document.getElementById('walletAddress').value;
            const withdrawalMethod = document.getElementById('withdrawalMethod').value;

            if (amount < 20) {
                alert('Minimum withdrawal amount is $20');
                return;
            }

            if (amount > currentUser.balance) {
                alert('Insufficient balance');
                return;
            }

            try {
                const response = await fetch('/api/user/withdrawal-request', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount,
                        walletAddress
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('withdrawalForm').reset();
                    showSuccess('Withdrawal Request Sent', 'Your withdrawal request has been submitted for processing');
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Withdrawal request failed:', error);
                alert('Failed to submit withdrawal request');
            }
        });

        // Load user statistics
        async function loadUserStats() {
            try {
                const response = await fetch('/api/user/stats', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    const stats = result.stats;
                    document.getElementById('totalGames').textContent = stats.totalGames;
                    document.getElementById('statsTotalGames').textContent = stats.totalGames;
                    document.getElementById('statsTotalBets').textContent = '$' + stats.totalBets.toFixed(2);
                    document.getElementById('statsTotalWins').textContent = '$' + stats.totalWins.toFixed(2);
                    document.getElementById('realGamesCount').textContent = stats.realGames;
                    document.getElementById('demoGamesCount').textContent = stats.demoGames;
                    document.getElementById('favoriteGame').textContent = stats.favoriteGame;

                    if (stats.lastWin) {
                        document.getElementById('lastWinInfo').innerHTML = `
                            <div class="text-center">
                                <i class="fas fa-trophy text-4xl text-yellow-400 mb-2"></i>
                                <div class="text-2xl font-bold text-green-400">$${stats.lastWin.amount.toFixed(2)}</div>
                                <div class="text-gray-300">${stats.lastWin.game}</div>
                                <div class="text-sm text-gray-400 mt-2">${new Date(stats.lastWin.date).toLocaleDateString()}</div>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Failed to load user stats:', error);
            }
        }

        // Success modal functions
        function showSuccess(title, message) {
            document.getElementById('successTitle').textContent = title;
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').style.display = 'flex';
        }

        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
        }

        // Document update function
        function updateDocument(docType) {
            alert(`To update your ${docType}, please contact support or re-register with new documents.`);
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('token');
            window.location.href = '/register-login';
        });

        // User menu toggle
        document.getElementById('userMenuButton').addEventListener('click', function() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === document.getElementById('successModal')) {
                closeSuccessModal();
            }
        });

        // Get current IP for security tab
        fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                document.getElementById('currentIP').textContent = data.ip;
            })
            .catch(error => {
                console.error('Failed to get IP:', error);
                document.getElementById('currentIP').textContent = 'Unknown';
            });
    </script>
</body>
</html>